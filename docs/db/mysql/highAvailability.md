数据库系统作为应用的核心基础设施,一旦发生故障将会对整个应用系统造成严重影响甚至导致系统瘫痪,因此保证数据库系统高可用性对于确保应用系统的稳定运行至关重要。MySQL 的高可用性（High Availability, HA）是指通过各种技术和架构设计确保数据库系统在面对硬件故障、网络问题或软件错误时仍能保持可访问性和数据完整性。实现 MySQL 高可用性的常见方法包括主从复制、双主复制、Galera Cluster、MySQL Group Replication、以及借助外部工具如 ProxySQL、MHA、Orchestrator 等。

## 主从复制(Master-Slave Replication)

MySQL 主从复制(Master-Slave Replication)是 MySQL 数据库提供的一种数据复制技术，用于在多个服务器之间复制数据,确保数据的一致性和高可用性。主从复制的基本思想是将主节点（Master）的数据变化通过二进制日志（binlog）传递到一个或多个从节点（Slave），从节点再应用这些日志，以达到数据同步的目的。主从复制流程:

主从复制优点:

- 读写分离:通过读写分离，主节点处理写操作，从节点处理读操作，提高整体性能。
- 数据备份:从节点可以作为数据备份的来源，提高数据安全性。
- 高可用性:如果主节点发生故障，可以迅速切换到从节点，减少停机时间。

### 主从复制的类型

在 MySQL 中提供了异步复制、半同步复制、同步复制三种主从复制类型,三者对比如下:

| 复制类型   | 数据一致性 | 性能 | 复杂性 | 数据丢失风险 |
| ---------- | ---------- | ---- | ------ | ------------ |
| 异步复制   | 较低       | 高   | 低     | 高           |
| 半同步复制 | 中等       | 中等 | 中等   | 中等         |
| 同步复制   | 高         | 低   | 高     | 低           |

#### 异步复制

在异步复制(Asynchronous Replication)下,主节点(Master)在执行写操作后,会立即将结果返回给客户端,并将这些操作记录到二进制日志(binlog)中。从节点（Slave）异步地读取主节点的二进制日志,并应用二进制日志(binlog)以保持数据一致性。由于主节点在执行写操作后不需要等待从节点确认,因此异步复制具有响应速度快、性能开销小等优点,但是无法保证数据一致性和同步延迟问题:

- 数据一致性:由于主节点不等待从节点的确认,可能会导致从节点的数据落后于主节点。在主节点故障时,可能会丢失未同步的数据。
- 同步延迟:从节点读取和应用主节点的二进制日志有延迟,可能导致读到的不是最新数据。

使用异步复制虽然具有良好的性能和较低的同步开销,但是可能会产生数据不一致和同步延迟问题,因此通常适用于对性能要求高(例如读写分离)、对实时性要求的场景,例如报表查询、数据分析。

#### 半同步复制

在半同步复制(Semi-Synchronous Replication)下,主节点在写操作完成后等待至少一个从节点确认日志已接收，但不等待应用完成。提供比异步复制更好的数据一致性。在半同步复制下,虽然提高了数据一致性,减少了主节点故障时的数据丢失风险,但是由于主节点需要等待从节点的确认,因此会增加写操作的响应时间,导致性能下降,通常适用于需要在性能和数据一致性之间取得平衡、对数据丢失有一定容忍度(但希望减少数据丢失风险)的场景。

#### 同步复制

在同步复制(Synchronous Replication)下,主节点在执行写操作后,将操作记录到二进制日志中。主节点会等待所有从节点确认已经接收到并应用了这些日志后，才返回操作结果给客户端。同步复制提供最高的数据一致性,确保所有从节点的数据与主节点完全同步,在主节点发生故障时,数据丢失风险最小。由于主节点需要等待所有从节点的确认,会导致写操作的响应时间显著增加,从而影响性能。
